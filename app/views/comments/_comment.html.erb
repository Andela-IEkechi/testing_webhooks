<%
  changeset = {}
  previous = comment.previous

  #get what changed
  [:status_id, :feature_id, :sprint_id, :assignee_id, :cost, :assets].each do |attr|
    now = comment.send(attr)
    if previous
      was = previous.send(attr)
      changeset[attr] = [now] if now != was
    else
      changeset[attr] = [now]
    end
  end
  changeset[:user] = comment.user.to_s
%>

<div class="well">
  <% if changeset[:user] %>
    <p><b><%= changeset[:user] %></b> <em title="<%= comment.updated_at %>"><%= distance_of_time_in_words_to_now comment.updated_at %></em> ago</p>
  <% end %>
  <% if changeset[:status_id] %>
    <p>status changed to <b><%= comment.status %></b></p>
  <% end %>
  <% if changeset[:feature_id] %>
    <p>now part of feature: <b><%= comment.feature || 'none' %></b></p>
  <% end %>
  <% if changeset[:sprint_id] %>
    <p>now part of sprint: <b><%= comment.sprint || 'none' %></b></p>
  <% end %>
  <% if changeset[:assignee_id] %>
    <p>assigned to: <b><%= comment.assignee || 'none' %></b></p>
  <% end %>
  <% if changeset[:cost] %>
    <p>cost updated to: <b><%= comment.cost %></b></p>
  <% end %>
  <div id="comment_show_div<%= comment.id %>"><%= comment.html.html_safe %></div>
  
  <div id="comment_edit_div<%= comment.id %>" style="display:none;">
    <%= form_tag({:controller => "comments", :action => "ajax_update"}, :remote => true) do %>
      <%= hidden_field_tag "comment_id", comment.id %>
      <%= hidden_field_tag "comment_cost", comment.cost %>
      <%= text_area_tag :comment_body, "#{comment.body}", :class => "input-block-level" %>
      <br />
      <%= submit_tag "Save" %>
    <% end %>
  </div>

  <% comment.assets && comment.assets.each do |asset| %>
    <%= link_to asset.name, asset.payload_url, :target => '_blank' %><br />
  <% end %>

  <p><a id="comment_edit_button<%= comment.id %>" href="#" onclick="$('#comment_edit_button<%= comment.id %>').hide(); $('#comment_show_div<%= comment.id %>').hide(); $('#comment_edit_div<%= comment.id %>').show(); return false;">edit</a></p>
</div>
