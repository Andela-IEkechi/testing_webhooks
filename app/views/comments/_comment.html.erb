<%
  changeset = {}
  previous = comment.previous

  #get what changed
  [:status_id, :feature_id, :sprint_id, :assignee_id, :cost, :assets].each do |attr|
    now = comment.send(attr)
    if previous
      was = previous.send(attr)
      changeset[attr] = [now] if now != was
    else
      changeset[attr] = [now]
    end
  end
%>

<div class="well">
  <% if comment.user %>
    <p><b><%= comment.user.to_s %></b> <em title="<%= comment.updated_at %>"><%= distance_of_time_in_words_to_now comment.updated_at %></em> ago</p>
  <% end %>
  <div><%= comment.html.html_safe %></div>

  <% comment.assets && comment.assets.each do |asset| %>
    <%= link_to asset.name, asset.payload_url, :target => '_blank' %><br />
  <% end %>


  <% if changeset.size > 0 %>
  <div class="comment-statusbar">
    <% if changeset[:status_id] %>
      <span>state: <b><%= comment.status %></b></span>
    <% end %>
    <% if changeset[:feature_id] %>
      <span>feature: <b><%= comment.feature || 'none' %></b></span>
    <% end %>
    <% if changeset[:sprint_id] %>
      <span>sprint: <b><%= comment.sprint || 'none' %></b></span>
    <% end %>
    <% if changeset[:assignee_id] %>
      <span>assignee: <b><%= comment.assignee || 'none' %></b></span>
    <% end %>
    <% if changeset[:cost] %>
      <span>cost: <b><%= cost_long(comment.cost) %></b></span>
    <% end %>
  </div>
  <% end %>

  <% if can?(:manage, comment) %>
  <div class="pull-right">
    <% if comment_counter == 0 %>
      <p>
        <%= link_to "edit ticket", edit_ticket_path(@ticket.id) %> |
        <%= link_to "remove ticket", ticket_path(@ticket.id), :method => :delete, :data => { :confirm => 'Are you sure?' } %>
      </p>
    <% else %>
      <p>
        <%= link_to "edit", edit_ticket_comment_path(@ticket.id, comment.id) %> |
        <%= link_to "remove", ticket_comment_path(@ticket.id, comment.id), :method => :delete, :data => { :confirm => 'Are you sure?' } %>
      </p>
    <% end %>
  </div>
  <% end %>

</div>
