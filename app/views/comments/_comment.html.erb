<%
  changeset = change_set(comment)
%>

<div class="comment-container" id="comment-<%= comment.id %>">
  <p class="muted"><%= author(comment) %> <em title="<%= comment.updated_at %>"><%= distance_of_time_in_words_to_now comment.updated_at %> ago</em></p>
  <div class="comment-body"><%= comment.html.html_safe %></div>

  <% comment.assets && comment.assets.each do |asset| %>
  <%
    link_name = image_tag(asset.payload_url(:thumb), class: 'img-polaroid img-padded')  if asset.image?
    link_name ||= asset.name
  %>
    <%= link_to link_name, asset.payload_url, :target => '_blank', :title => (number_to_human_size(asset.payload.file.size) rescue 'unknown') %>
  <% end %>

  <div class="comment-statusbar">
    <% if can?(:manage, comment) %>
    <div class="pull-right comment-actions">
      <% unless comment.first? %>
          <%= link_to edit_project_ticket_comment_path(@ticket.project, @ticket, comment), :title => 'edit this comment' do %>
            <span><i class='icon-edit'></i>edit</span>
          <% end %>
          &nbsp;
          <%= link_to project_ticket_comment_path(@ticket.project, @ticket, comment), :remote => true, :method => :delete, :data => { :confirm => 'Are you sure you want to remove this comment?' }, :title => 'remove this comment' do %>
            <span><i class='icon-trash'></i>remove</span>
          <% end %>
      <% end %>
    </div>
    <% end %>

    <ul class="inline">
      <% if changeset[:status_id] %>
        <li>
          state: <b><%= comment.status %></b>
        </li>
      <% end %>
      <% if changeset[:feature_id] %>
        <li>
          feature: <b><%= comment.feature || 'none' %></b>
        </li>
      <% end %>
      <% if changeset[:sprint_id] %>
        <li>
          sprint: <b><%= comment.sprint || 'none' %></b>
        </li>
      <% end %>
      <% if changeset[:assignee_id] %>
        <li>
          assignee: <b><%= comment.assignee || 'none' %></b>
        </li>
      <% end %>
      <% if changeset[:cost] %>
        <li>
          cost: <b><%= cost_long(comment.cost) %></b>
        </li>
      <% end %>
      <% if false && changeset.keys.count == 0 %>
        <li>
          no change
        </li>
      <% end %>
    </ul>
  </div>

</div>
