<h3>
  Update Your Account
  <small> currently <%= @account.current_plan[:title] %> </small>
</h3>
  
<div class="row-fluid marketing">
  <div class="tab-pane">
    <div class="price-table price-table-three">
      <% plans = Plan::PLANS.reject{|k,v| k.to_s == @account.plan} %>
      <div class="price-column  price-column-first">
        <%= render partial: '/shared/plan', object: Plan.new(plans.keys[0]) %>
      </div>
      <div class="price-column  price-column-last <%= 'price-column-featured' unless @account.current_plan.better_than?(plans.keys[1]) %>">
        <%= render partial: '/shared/plan', object: Plan.new(plans.keys[1]) %>
      </div>
      <div class="price-column  price-column-last <%= 'price-column-featured' if @account.current_plan.better_than?(plans.keys[1])%>">
        <%= render partial: '/shared/plan', object: Plan.new(plans.keys[2]) %>
      </div>
    </div>
  </div>
</div>

<div id="flash_notice">
  <% flash[:notice_1] = "You are about to upgrade your account. Please note that the once-off pro rated payment will apply. Your payment date will be on this day every month from now on." %>
  <% flash[:alert_1] = "You are about to downgrade your account. Please note that in doing so, you may forfeit a part of your current subscription for this month." %>
  <% flash[:notice_2] = "Unfortunately you will not be able to downgrade to a smaller plan. You are currently exceeding the maximum amount of projects in the plan you selected." %>
</div>

<div id="checkout_form">
  <%= form_tag Rails.configuration.checkout[:url], :name => 'Conductor Secure Payment', :id => "checkout_form", :method => :post do %>

    <%= hidden_field_tag "sid", Rails.configuration.checkout[:checkout_id] %>
    <%= hidden_field_tag "mode", '2CO' %>
    <%= hidden_field_tag "demo", 'Y' %>
    <%= hidden_field_tag "li_1_price", '' %>
    <%= hidden_field_tag "li_1_name", '' %>
    <%= hidden_field_tag "li_1_tangible", 'N' %>
    <%= hidden_field_tag "li_1_quanity", '1' %>
    <%= hidden_field_tag 'fixed', 'Y' %>
    <%= hidden_field_tag "li_1_startup_fee", '' %>
    <%= hidden_field_tag "li_1_type", 'product' %>
    <%= hidden_field_tag "li_1_recurrence", '1 Month' %>
    <%= hidden_field_tag "li_1_duration", 'Forever' %>
    <%= hidden_field_tag "currency_code", 'USD' %>
    <%= hidden_field_tag "x_receipt_link_url", payment_return_user_account_url(:host => "local.conductor.com",:auth_token => @user.authentication_token) %>

    <div class="row-fluid pagination-centered">
      <br>
      <%= submit_tag "Update Subscription", :class => "btn btn-info btn-large", :id => 'account_change' %>
    </div>
  <% end %>
</div>

<div id="downgrade_form"><!--Downgrade or cancel, post back to conductor-->
  <%= form_tag payment_update_user_account_url, :name => 'Conductor Secure Payment', :id => "downgrade_form", :method => :post do %>

    <%= hidden_field_tag "li_1_price", '' %>
    <%= hidden_field_tag "account", "#{@account.id}" %>
    <%= hidden_field_tag "DATE", "#{Time.now.strftime('%Y-%m-%d')}" %>

    <div class="row-fluid pagination-centered">
      <br>
      <%= submit_tag "Update Subscription", :class => "btn btn-info btn-large", :id => 'account_change' %>
    </div>
  <% end %>
</div>
